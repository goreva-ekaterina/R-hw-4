---
title: "Горева Екатерина Анатольевна, ДЗ 4"
output: html_document
date: "2024-04-03"
---

```{r}
# библиотеки 
library(tidyverse)
library(ggplot2)
```

## Задание 1  
Создаем seed и размер выборки
```{r}
set.seed(25)
sample_size <- 30
```
Задаем значение среднего артериального давления до приема нового препарата и после
```{r}
pressure_0 <- 150  
pressure_1 <- 120
```
генерируем распределение и определяем стандартное отклонение дл давления до и после
```{r}
sd_pressure_0 <- 15
set_pressure_0 <- rnorm(sample_size, pressure_0, sd_pressure_0)
sd_pressure_1 <- 8
set_pressure_1 <- rnorm(sample_size, pressure_1, sd_pressure_1)

```
Создаем датафрейм
```{r}
pressure_data <- data.frame(Before = set_pressure_0,After = set_pressure_1)
head(pressure_data)
```

Нулевая и альтернативная  гипотезы: 
H0: артериальное давление до и после приема препарата значимо не отличаются. H1: есть статистически значимые различия до и после приема препарата. 

Уроверь значимости:  
0.05 

```{r}
# проверка распределения для выбора теста  с помощью Шапиро-Уилка
shapiro.test(pressure_data$Before)
shapiro.test(pressure_data$After)
```
Исходя из значений p-value (>0,05), распределения нормальные и для выборки до препарата, и для выборки после перпарата.  

Статистический тест для проверки гипотезы:  
Значения в обоих столбцах датафрейма распределены нормально, выборки зависимые (т.к. это одни и те же люди). Мы можем использовать парный t-test. 

```{r}
#  парный t-test
t.test(pressure_data$Before, pressure_data$After, paired = TRUE)
``` 
Интерпретация результатов парного t-test.  
95% доверительный интервал: 21.76562 - 36.70610 
Средняя разница между значениями - 29.23586
Количество степеней свободы : 29
T-статистика: 8.0043

Определяем наблюдаемое значение статистики, а также критическое значение статистики.
```{r}
# критическое значение для распределения
# df = 29
alpha = 0.05
qt(1 - alpha/2, df = 29)
```
Критическое значение при получившемся количестве степеней свободы: 2.04523.  Значение t-статистики (8.0043) гораздо выше. Отвергаем Н0, принимаем Н1: есть статистически значимые различия до и после приема препарата

Оцените и прокомментируйте статистическую значимость.  

Значение p (7.926e-09) меньше  < alpha (0,05). 
Принимаем Н1: есть статистически значимые различия до и после приема препарата.  

## Задание 2   
Создаем два датафрейма исходя из условий задания 
```{r}
# задаем параметры для новых выборов 
sample_size1 <- 100 
sample_size2 <- 30
# генерируем данные по курению 
# отношение числа курящих к некурящим в каждой выборке составляет 1:1 по условию
# создаем векторы для двух выборок курильщиков
smokers <- rep(c(1, 0), each = (sample_size1 / 2))
smokers_2 <- rep(c(1, 0), each = (sample_size2 / 2))

# генерируем данные (бинарный признак) для рака легких для выборки sample_size1
# Пусть у курящих людей вероятность заболеть раком легких составляет 0.8, а у некурящих — 0.2 (по условию)
set.seed(10) 
cancer_smokers <- rbinom((sample_size1 / 2), 1, 0.8)
cancer_norm <- rbinom((sample_size1 / 2), 1, 0.2)
cancer<- c(cancer_smokers, cancer_norm)
cancer
```
```{r}
# создаем датафрейм, в котором будут распределены наличие/отсутсвие рака и курения
df_sample_Size_100 <- data.frame(Smoking = smokers, Cancer = cancer)
head(df_sample_Size_100)
```
```{r}
# теперь генерируем данные по меньшей выборке (аналогичным образом)
smokers_2 <- rep(c(1, 0), each = (sample_size2 / 2))
set.seed(1) 
cancer_smokers_2 <- rbinom((sample_size2 / 2), 1, 0.8)
cancer_norm_2 <- rbinom((sample_size2 / 2), 1, 0.2)
cancer_2 <- c(cancer_smokers_2, cancer_norm_2)
df_sample_Size_30 <- data.frame(Smoking = smokers_2, Cancer = cancer_2)
head(df_sample_Size_30)
```
Гипотезы:

H0: вероятность развития рака у курящих и некурящих статистически значимо не различается.H1: риск развития рака у курильщиков статистически значимо выше, чем группе некурящих.`

Уровень значимости: 
alpha=0.05  

Выбор ститистического теста.  
Переменные независимые (курильщики и некурящий - это разные люди), переменные категориальные (бинарные). Используем тест Фишера. Нам нужно будет построить таблицу сопряженности.  
```{r}
# таблица сопряденности для df_sample_Size_100
cont_df_100 <- table(df_sample_Size_100$Smoking, df_sample_Size_100$Cancer)
cont_df_100
```
```{r}
# таблица сопряденности для df_sample_Size_30
cont_df_30 <- table(df_sample_Size_30$Smoking, df_sample_Size_30$Cancer)
 

```
```{r}
# Тест Фишера для для большей выборки
fisher_100 <- fisher.test(cont_df_100, alternative = "greater")
fisher_100
```
p-value = 2.31e-15
Доверительный интервал 95%: 17.0248 - Inf
Отношение шансов: 51.4313
```{r}
# Тест Фишера для для большей выборки
fisher_30 <- fisher.test(cont_df_30, alternative = "greater")
fisher_30
```
p-value = 0.001407
Доверительный интервал 95%: 2.660628  - Inf
Отношение шансов:  14.11256 


Оценка статистической значимости:  

В обоиз случаях p-value меньше  alpha=0,05. Принимаем гипотезу H1: риск развития рака у курильщиков статистически значимо выше, чем группе некурящих. Вероятность развития рака легких в группе курящих выше в 51.4313 (для выборки 100) и 14.11256 (для выборки 30). 

## Задание 3  
Гипотезы: 
H0: Уровень болевых симптомов при применении нового метода лечения СРК значимо НЕ отличается от уровня болеви у группы лечившейся диетотерапией.
H1: Уровень болевых симптомов при применении нового метода лечения СРК значимо отличается от уровня болеви у группы лечившейся диетотерапией.

```{r}
# Создадим выборки
set.seed(50)
sample_size <- 100

#Выборка для новой терапии
mean_new_therapy <- 15
sd_new_therapy <- 2
new_therapy <- round(rnorm(sample_size, mean_new_therapy, sd_new_therapy))
#Выборка для диеты
mean_diet_therapy <- 10
sd_diet_therapy <- 2
diet_therapy <- round(rnorm(sample_size, mean_diet_therapy, sd_diet_therapy))

# создаем датафрейм
therapy_sum <- data.frame(New_therapy = new_therapy,Diet_therapy = diet_therapy)
head(therapy_sum)
```
Уровень значимости:  
alpha = 0,05  

Оценим распределение с помощью Шапиро-Уилка
```{r}
shapiro.test(therapy_sum$New_therapy)
shapiro.test(therapy_sum$Diet_therapy)
```
В обоих случах распределение нормальное, судя по значениям p-value.   
При выборе стат.теста мы опираемся на то, что выборки независимые и имеют нормальное распределение. Нам подойдет t-критерий Стьюдента для независимых выборок, чтобы сравнить средние значения у двух выборок. 


```{r}
t.test(therapy_sum$New_therapy, therapy_sum$Diet_therapy)
```
Значение p-value существенно меньше 0,05. Принимаем альтернативную гипотезу: Уровень болевых симптомов при применении нового метода лечения СРК значимо отличается от уровня болеви у группы лечившейся диетотерапией.  

определяем критическое значение статистики
```{r}
df<-197.86
alpha <- 0.05
t_critical <- qt(1 - alpha/2, df)
t_critical
```
Критическое значение при получившемся количестве степеней свободы: 1.972026.  Значение t-статистики (17.464) выше. Отвергаем Н0, принимаем Н1: Уровень болевых симптомов при применении нового метода лечения СРК значимо отличается от уровня болеви у группы лечившейся диетотерапией.  

## Задание 4  
Генерируем датасет
```{r}

tumor <- tibble(
  therapy = c(rep("0", 10), rep("A", 10), rep("B", 10)),
  value = c(rep(3213, 10), rep(2687, 10), rep(2423, 10))
) %>%
  mutate(therapy = factor(therapy, levels = c("0", "A", "B")))
tumor$value <- tumor$value + rnorm(30, 0, 760)
tumor
```
Сформулируем гипотезы: 
H0: нет статистически значимых различий между размером опухоли в трех группах.`
H1: есть статистически значимые различия между размером опухоли в трех группах.`  
alpha = 0.05  

Строим боксплоты
```{r}
# Боксплот для 3 категорий терапии мышей
ggplot(tumor, aes(x = therapy, y = value, fill = therapy)) + geom_boxplot() +
  labs(title = "Размер опухоли в зависимости от типа терапии", x = "Терапия", y = "Размер опухоли") +
  theme_classic()
```
Проанализируем распределение
```{r}
shapiro.test(tumor$value[tumor$therapy == 0])
shapiro.test(tumor$value[tumor$therapy == 'A'])
shapiro.test(tumor$value[tumor$therapy == 'B'])
```
В выборке 0 и В распрелеоение нормальное. В выборке А - отличное от нормального. 

Дисперсионный анализ, чтобы выяснить, есть ли разница между размером опухоли во всех группах

```{r}
# теста Левена для оценки гомогенности дисперсий
library(car)
leveneTest(value ~ therapy, data = tumor)
```
Дисперсии гомогенны.  
У нас одна из выборок имеет распределение отличное от нормального, поэтому используем тест Краскела-Уоллиса 
```{r}
kruskal_test = kruskal.test(value ~ therapy, data = tumor)
kruskal_test
```
p-value = 0.001601,  
Количество степеней свободы df = 2  
chi-squared = 12.875  
Исходя из значения p-value, мы принимаем H1,т.к. есть различия размера опухоли в трех выборках. 

  
  Теперь нам нужно сравнить выборки попарно и точнее сказать, какие выборки отличаются. Используем для этого тест Тьюки, но сначала нужно провести ANOVA
  
```{r}
model <- aov (value ~ therapy, data = tumor)
model
```
```{r}
# тест Тьюки
tukey_test <- TukeyHSD(model, confV.level = 0.95)
tukey_test
```
По значениям p adj, которые мы сравниваем с alpha (0,05), мы делаем основные выводы.  
Для сравнения A-0 - 0.1585403, B-0 - 0.0003256, В-А - 0.0375283. Для B-0 и B-A принимается альтернативная гипотеза (есть статистически значимые различия в группах). Для A-0 налевую гипотезу отвергнуть не можем (нет ститистически значимых различий между группами). 


